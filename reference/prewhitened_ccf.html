<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate cross-correlation coefficients for prewhitened time series — prewhitened_ccf • ebtools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Calculate cross-correlation coefficients for prewhitened time series — prewhitened_ccf" />
<meta property="og:description" content="prewhitened_ccf() prewhitens time series, calculates cross-correlation coefficients, and returns statistically significant values." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ebtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/ercbk/ebtools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate cross-correlation coefficients for prewhitened time series</h1>
    <small class="dont-index">Source: <a href='https://github.com/ercbk/ebtools/blob/master/R/prewhitened-ccf.R'><code>R/prewhitened-ccf.R</code></a></small>
    <div class="hidden name"><code>prewhitened_ccf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>prewhitened_ccf()</code> prewhitens time series, calculates cross-correlation coefficients, and returns statistically significant values.</p>
    </div>

    <pre class="usage"><span class='fu'>prewhitened_ccf</span><span class='op'>(</span>
  <span class='va'>input</span>,
  <span class='va'>output</span>,
  <span class='va'>input_col</span>,
  <span class='va'>output_col</span>,
  keep_input <span class='op'>=</span> <span class='st'>"both"</span>,
  keep_ccf <span class='op'>=</span> <span class='st'>"both"</span>,
  <span class='va'>max.order</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>input</th>
      <td><p>tsibble; The influential or "predictor-like" time series</p></td>
    </tr>
    <tr>
      <th>output</th>
      <td><p>tsibble; The affected or "response-like" time series</p></td>
    </tr>
    <tr>
      <th>input_col</th>
      <td><p>string; Name of the numeric column of the input tsibble</p></td>
    </tr>
    <tr>
      <th>output_col</th>
      <td><p>string; Name of the numeric column of the output tsibble</p></td>
    </tr>
    <tr>
      <th>keep_input</th>
      <td><p>string; values: "input_lags", "input_leads" or "both"; Default is "both".</p></td>
    </tr>
    <tr>
      <th>keep_ccf</th>
      <td><p>string; values: "positive", "negative", or "both; Default is "both"</p></td>
    </tr>
    <tr>
      <th>max.order</th>
      <td><p>integer; The maximum lag used in the CCF calculation.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A tibble with the following columns:</p><ul>
<li><p>input_type: "lag" or "lead"</p></li>
<li><p>input_series: lag or lead number</p></li>
<li><p>signif_type: "Statistically Significant" or "Not Statistically Significant"</p></li>
<li><p>signif_threshold: Threashold CCF value for statistical significance at the 95% level</p></li>
<li><p>ccf: Calculated ccf value</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>In a cross-correlation in which the direction of influence between two time-series is hypothesized or known,</p><ul>
<li><p>the influential time-series is called the "input" time-series</p></li>
<li><p>the affected time-series is called the "output" time-series</p></li>
</ul>

<p>The cross-correlation function calculates correlation values between lags and leads of the input series and the output series. Sometimes only correlations between the leads or lags of the input series and the output series make theoretical sense, or only positive or negative correlations make theoretical sense.</p><ul>
<li><p>The "keep_input" argument specifies whether you want to keep only output CCF values involving leads or lags of the input series or both.</p></li>
<li><p>The "keep_ccf" argument specifies whether you want to keep only output positive, negative, or both CCF values.</p></li>
</ul>

<p><code>prewhitened_ccf</code> differences the series if it's needed, prewhitens, and outputs either statistically significant values of the CCF or the top non-statistically significant value if no statistically significant values are found. The prewhitening method that is used is from Cryer and Chan (2008, Chapter 11).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Cryer, D., Chan, K. (2008) Time Series Analysis, Springer Science+Business Media, LLC</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>oh_cases</span> <span class='op'>&lt;-</span> <span class='va'>ohio_covid</span> <span class='op'>%&gt;%</span>
   <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>cases</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>tsibble</span><span class='fu'>::</span><span class='fu'><a href='https://tsibble.tidyverts.org/reference/as-tsibble.html'>as_tsibble</a></span><span class='op'>(</span>index <span class='op'>=</span> <span class='va'>date</span><span class='op'>)</span>

<span class='va'>oh_deaths</span> <span class='op'>&lt;-</span> <span class='va'>ohio_covid</span> <span class='op'>%&gt;%</span>
   <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>deaths_lead0</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>tsibble</span><span class='fu'>::</span><span class='fu'><a href='https://tsibble.tidyverts.org/reference/as-tsibble.html'>as_tsibble</a></span><span class='op'>(</span>index <span class='op'>=</span> <span class='va'>date</span><span class='op'>)</span>

<span class='va'>oh_ccf_tbl</span> <span class='op'>&lt;-</span> <span class='fu'>prewhitened_ccf</span><span class='op'>(</span>input <span class='op'>=</span> <span class='va'>oh_cases</span>,
                              output <span class='op'>=</span> <span class='va'>oh_deaths</span>,
                              input_col <span class='op'>=</span> <span class='st'>"cases"</span>,
                              output_col <span class='op'>=</span> <span class='st'>"deaths_lead0"</span>,
                              max.order <span class='op'>=</span> <span class='fl'>40</span>,
                              keep_input <span class='op'>=</span> <span class='st'>"input_lag"</span>,
                              keep_ccf <span class='op'>=</span> <span class='st'>"positive"</span><span class='op'>)</span>

<span class='va'>oh_ccf_tbl</span>
</div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 1 x 5</span><span>
#&gt;   input_type input_series signif_type                   signif_thresh    ccf
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                                 </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> lag                  10 Not Statistically Significant         0.123 0.098</span><span style='text-decoration: underline;'>5</span><span></div><div class='input'>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span>, warn.conflicts <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='va'>reg_cases_tsb</span> <span class='op'>&lt;-</span> <span class='va'>us_regional_cases</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tsibble</span><span class='fu'>::</span><span class='fu'><a href='https://tsibble.tidyverts.org/reference/as-tsibble.html'>as_tsibble</a></span><span class='op'>(</span>index <span class='op'>=</span> <span class='va'>date</span>, key <span class='op'>=</span> <span class='va'>region</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tsibble</span><span class='fu'>::</span><span class='fu'><a href='https://tsibble.tidyverts.org/reference/group_by_key.html'>group_by_key</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tidyr</span><span class='fu'>::</span><span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>nest</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>region</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>reg_deaths_tsb</span> <span class='op'>&lt;-</span> <span class='va'>us_regional_deaths</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tsibble</span><span class='fu'>::</span><span class='fu'><a href='https://tsibble.tidyverts.org/reference/as-tsibble.html'>as_tsibble</a></span><span class='op'>(</span>index <span class='op'>=</span> <span class='va'>date</span>, key <span class='op'>=</span> <span class='va'>region</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tsibble</span><span class='fu'>::</span><span class='fu'><a href='https://tsibble.tidyverts.org/reference/group_by_key.html'>group_by_key</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tidyr</span><span class='fu'>::</span><span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>nest</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>region</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>reg_ccf_vals</span> <span class='op'>&lt;-</span> <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map2.html'>map2_dfr</a></span><span class='op'>(</span><span class='va'>reg_cases_tsb</span><span class='op'>$</span><span class='va'>data</span>,
                                <span class='va'>reg_deaths_tsb</span><span class='op'>$</span><span class='va'>data</span>,
                                <span class='va'>prewhitened_ccf</span>,
                                input_col <span class='op'>=</span> <span class='st'>"reg_sev_day_cases"</span>,
                                output_col <span class='op'>=</span> <span class='st'>"reg_sev_day_deaths"</span>,
                                max.order <span class='op'>=</span> <span class='fl'>40</span>,
                                .id <span class='op'>=</span> <span class='st'>"id"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>reg_cases_tsb</span> <span class='op'>%&gt;%</span>
             <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>id</span>, <span class='va'>region</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"id"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>reg_ccf_vals</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 6 x 7</span><span>
#&gt;   id    input_type input_series signif_type          signif_thresh    ccf region
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>1</span><span> 1     lag                  39 Statistically Signi…        -</span><span style='color: #BB0000;'>0.110</span><span> -</span><span style='color: #BB0000;'>0.124</span><span> midwe…
#&gt; </span><span style='color: #555555;'>2</span><span> 1     lag                  38 Statistically Signi…        -</span><span style='color: #BB0000;'>0.110</span><span> -</span><span style='color: #BB0000;'>0.170</span><span> midwe…
#&gt; </span><span style='color: #555555;'>3</span><span> 1     lag                  36 Statistically Signi…         0.110  0.189 midwe…
#&gt; </span><span style='color: #555555;'>4</span><span> 1     lag                  35 Statistically Signi…         0.110  0.249 midwe…
#&gt; </span><span style='color: #555555;'>5</span><span> 1     lag                  32 Statistically Signi…        -</span><span style='color: #BB0000;'>0.110</span><span> -</span><span style='color: #BB0000;'>0.156</span><span> midwe…
#&gt; </span><span style='color: #555555;'>6</span><span> 1     lag                  30 Statistically Signi…        -</span><span style='color: #BB0000;'>0.110</span><span> -</span><span style='color: #BB0000;'>0.212</span><span> midwe…</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Eric Book.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


